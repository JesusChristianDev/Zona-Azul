table_number,table_name,description,columns,primary_key,foreign_keys,indexes,notes
1,users,Todos los usuarios del sistema (6 roles diferentes),"id (UUID), email (VARCHAR), role (ENUM), first_name, last_name, phone, avatar_url, is_active, created_by (UUID), activation_token (VARCHAR), activated_at (TIMESTAMP), created_at, updated_at",id,created_by → users(id),"idx_users_email, idx_users_role, idx_users_activation_token","MODIFICADO: Agregados campos created_by, activation_token, activated_at para cuentas creadas por nutricionista/admin"
2,customers,Datos específicos de clientes (extends users),"id (UUID), user_id (UUID), nutritionist_id (UUID), weight (DECIMAL), height (DECIMAL), age (INT), gender (ENUM), goal (ENUM), activity_level (ENUM), allergies (TEXT[]), dietary_restrictions (TEXT[]), address (JSONB), appointment_id (UUID), created_at, updated_at",id,"user_id → users(id), nutritionist_id → users(id), appointment_id → appointment_requests(id)","idx_customers_user, idx_customers_nutritionist, idx_customers_appointment",MODIFICADO: Agregado appointment_id para vincular con la cita original
3,customer_tracking,Historial de seguimiento de progreso del cliente,"id (UUID), customer_id (UUID), weight (DECIMAL), body_fat_percentage (DECIMAL), measurements (JSONB), progress_photo_url (VARCHAR), notes (TEXT), tracked_at (TIMESTAMP), created_at",id,customer_id → customers(id),"idx_tracking_customer, idx_tracking_date",Sin cambios
4,team_members,"Información adicional de empleados (cocina, logística, etc.)","id (UUID), user_id (UUID), department (ENUM), shift (ENUM), availability (JSONB), hired_at (TIMESTAMP), created_at, updated_at",id,user_id → users(id),"idx_team_user, idx_team_department",Sin cambios
5,subscriptions,Suscripciones activas de clientes,"id (UUID), customer_id (UUID), plan_type (ENUM), billing_cycle (ENUM), price (DECIMAL), status (ENUM), delivery_method (ENUM), start_date (DATE), next_billing_date (DATE), paused_until (DATE), cancelled_at (TIMESTAMP), created_at, updated_at",id,customer_id → customers(id),"idx_subscriptions_customer, idx_subscriptions_status, idx_subscriptions_next_billing",Sin cambios
6,subscription_events,Historial de cambios en suscripciones,"id (UUID), subscription_id (UUID), event_type (ENUM), previous_status (ENUM), new_status (ENUM), reason (TEXT), metadata (JSONB), created_at",id,subscription_id → subscriptions(id),"idx_events_subscription, idx_events_type, idx_events_date",Sin cambios
7,payments,Registro de todos los pagos,"id (UUID), subscription_id (UUID), amount (DECIMAL), currency (VARCHAR), payment_method (ENUM), status (ENUM), stripe_payment_id (VARCHAR), paypal_transaction_id (VARCHAR), metadata (JSONB), paid_at (TIMESTAMP), created_at",id,subscription_id → subscriptions(id),"idx_payments_subscription, idx_payments_status, idx_payments_date",Sin cambios
8,recipes,Catálogo de recetas base,"id (UUID), name (VARCHAR), description (TEXT), category (ENUM), calories (INT), protein (DECIMAL), carbs (DECIMAL), fats (DECIMAL), fiber (DECIMAL), prep_time_minutes (INT), allergens (TEXT[]), photo_url (VARCHAR), instructions (TEXT), cost_per_serving (DECIMAL), is_active (BOOLEAN), created_by (UUID), created_at, updated_at",id,created_by → users(id),"idx_recipes_category, idx_recipes_active, idx_recipes_created_by",Sin cambios
9,recipe_ingredients,Ingredientes por receta,"id (UUID), recipe_id (UUID), ingredient_name (VARCHAR), quantity (DECIMAL), unit (VARCHAR), notes (TEXT)",id,recipe_id → recipes(id),idx_ingredients_recipe,Sin cambios
10,recipe_statistics,Estadísticas de popularidad de recetas,"id (UUID), recipe_id (UUID), times_served (INT), average_rating (DECIMAL), total_ratings (INT), last_served_at (TIMESTAMP), updated_at",id,recipe_id → recipes(id),idx_stats_recipe,Sin cambios
11,meal_plans,Planes nutricionales personalizados por cliente,"id (UUID), customer_id (UUID), daily_calories (INT), protein_grams (INT), carbs_grams (INT), fats_grams (INT), notes (TEXT), is_active (BOOLEAN), created_by (UUID), created_at, updated_at",id,"customer_id → customers(id), created_by → users(id)","idx_plans_customer, idx_plans_active",Sin cambios
12,weekly_menus,Menús semanales publicados,"id (UUID), week_start_date (DATE), week_end_date (DATE), change_window_start (TIMESTAMP), change_window_end (TIMESTAMP), status (ENUM), published_at (TIMESTAMP), published_by (UUID), created_at",id,published_by → users(id),"idx_menus_week, idx_menus_status",Sin cambios
13,weekly_menu_items,Items individuales del menú semanal,"id (UUID), weekly_menu_id (UUID), recipe_id (UUID), day_of_week (INT), meal_type (ENUM), is_replaceable (BOOLEAN)",id,"weekly_menu_id → weekly_menus(id), recipe_id → recipes(id)","idx_menu_items_menu, idx_menu_items_day, idx_menu_items_recipe",Sin cambios
14,customer_meals,Comidas asignadas a cada cliente,"id (UUID), customer_id (UUID), subscription_id (UUID), weekly_menu_item_id (UUID), recipe_id (UUID), meal_date (DATE), meal_type (ENUM), status (ENUM), is_custom (BOOLEAN), created_at, updated_at",id,"customer_id → customers(id), subscription_id → subscriptions(id), weekly_menu_item_id → weekly_menu_items(id), recipe_id → recipes(id)","idx_customer_meals_customer, idx_customer_meals_date, idx_customer_meals_status",Sin cambios
15,meal_changes,Registro de cambios de comidas (ventana viernes-domingo),"id (UUID), customer_meal_id (UUID), original_recipe_id (UUID), new_recipe_id (UUID), changed_by (ENUM), reason (TEXT), changed_at (TIMESTAMP)",id,"customer_meal_id → customer_meals(id), original_recipe_id → recipes(id), new_recipe_id → recipes(id)","idx_changes_meal, idx_changes_date",Sin cambios
16,orders,Órdenes de producción diarias,"id (UUID), order_date (DATE), meal_type (ENUM), status (ENUM), total_meals (INT), assigned_to (UUID), started_at (TIMESTAMP), completed_at (TIMESTAMP), created_at",id,assigned_to → users(id),"idx_orders_date, idx_orders_status, idx_orders_assigned",Sin cambios
17,order_items,Items individuales de cada orden,"id (UUID), order_id (UUID), customer_meal_id (UUID), recipe_id (UUID), quantity (INT), status (ENUM), notes (TEXT), prepared_at (TIMESTAMP)",id,"order_id → orders(id), customer_meal_id → customer_meals(id), recipe_id → recipes(id)","idx_items_order, idx_items_status",Sin cambios
18,deliveries,Entregas programadas,"id (UUID), customer_meal_id (UUID), customer_id (UUID), delivery_date (DATE), delivery_method (ENUM), delivery_window_start (TIME), delivery_window_end (TIME), status (ENUM), assigned_to (UUID), address (JSONB), proof_photo_url (VARCHAR), signature_data (TEXT), delivered_at (TIMESTAMP), created_at",id,"customer_meal_id → customer_meals(id), customer_id → customers(id), assigned_to → users(id)","idx_deliveries_date, idx_deliveries_status, idx_deliveries_assigned",Sin cambios
19,inventory,Inventario de ingredientes,"id (UUID), ingredient_name (VARCHAR), current_stock (DECIMAL), unit (VARCHAR), minimum_stock (DECIMAL), cost_per_unit (DECIMAL), supplier (VARCHAR), last_restock_date (DATE), updated_at",id,,"idx_inventory_name, idx_inventory_low_stock",Sin cambios
20,nutritionist_sessions,Sesiones de consulta con clientes,"id (UUID), customer_id (UUID), nutritionist_id (UUID), session_date (TIMESTAMP), session_type (ENUM), notes (TEXT), recommendations (TEXT), next_session_date (DATE), created_at",id,"customer_id → customers(id), nutritionist_id → users(id)","idx_sessions_customer, idx_sessions_nutritionist, idx_sessions_date",Sin cambios
21,support_tickets,Tickets de soporte al cliente,"id (UUID), customer_id (UUID), subject (VARCHAR), category (ENUM), priority (ENUM), status (ENUM), assigned_to (UUID), created_at, updated_at, resolved_at (TIMESTAMP)",id,"customer_id → customers(id), assigned_to → users(id)","idx_tickets_customer, idx_tickets_status, idx_tickets_priority, idx_tickets_assigned",Sin cambios
22,support_messages,Mensajes dentro de tickets,"id (UUID), ticket_id (UUID), sender_id (UUID), message (TEXT), is_ai_generated (BOOLEAN), ai_confidence (DECIMAL), attachments (TEXT[]), created_at",id,"ticket_id → support_tickets(id), sender_id → users(id)","idx_messages_ticket, idx_messages_date",Sin cambios
23,customer_feedback,Feedback de clientes sobre comidas,"id (UUID), customer_id (UUID), customer_meal_id (UUID), recipe_id (UUID), rating (INT), comment (TEXT), created_at",id,"customer_id → customers(id), customer_meal_id → customer_meals(id), recipe_id → recipes(id)","idx_feedback_customer, idx_feedback_recipe, idx_feedback_date",Sin cambios
24,notifications,Registro de notificaciones enviadas,"id (UUID), user_id (UUID), type (ENUM), channel (ENUM), title (VARCHAR), message (TEXT), data (JSONB), is_read (BOOLEAN), sent_at (TIMESTAMP), read_at (TIMESTAMP)",id,user_id → users(id),"idx_notifications_user, idx_notifications_read, idx_notifications_date",Sin cambios
25,audit_logs,Registro de auditoría de acciones críticas,"id (UUID), user_id (UUID), action (VARCHAR), entity_type (VARCHAR), entity_id (UUID), old_data (JSONB), new_data (JSONB), ip_address (VARCHAR), user_agent (TEXT), created_at",id,user_id → users(id),"idx_logs_user, idx_logs_entity, idx_logs_date",Sin cambios
26,system_settings,Configuración global del sistema,"id (UUID), key (VARCHAR), value (JSONB), description (TEXT), updated_by (UUID), updated_at",id,updated_by → users(id),idx_settings_key,Sin cambios
27,analytics_cache,Caché de métricas calculadas para dashboard,"id (UUID), metric_name (VARCHAR), metric_value (DECIMAL), metadata (JSONB), calculated_at (TIMESTAMP), expires_at (TIMESTAMP)",id,,"idx_cache_metric, idx_cache_expires",Sin cambios
28,appointment_requests,"Solicitudes de citas con nutricionista (público, sin login)","id (UUID), full_name (VARCHAR), email (VARCHAR), phone (VARCHAR), goal (ENUM), message (TEXT), preferred_date (TIMESTAMP), status (ENUM), nutritionist_id (UUID), notes (TEXT), created_at, confirmed_at (TIMESTAMP), completed_at (TIMESTAMP)",id,nutritionist_id → users(id),"idx_appointments_status, idx_appointments_date, idx_appointments_nutritionist, idx_appointments_email","NUEVA TABLA: Gestiona solicitudes de citas antes de crear cuenta. Estados: pending, confirmed, completed, cancelled, no_show"
29,restaurant_menu,"Carta fija del restaurante (pública, sin login)","id (UUID), recipe_id (UUID), category (VARCHAR), price (DECIMAL), is_available (BOOLEAN), display_order (INT), created_at, updated_at",id,recipe_id → recipes(id),"idx_restaurant_menu_recipe, idx_restaurant_menu_category, idx_restaurant_menu_available","NUEVA TABLA: Carta pública del restaurante. Usa las mismas recetas pero con precio a la carta (no subscription). Categorías: mains, sides, desserts, drinks"
